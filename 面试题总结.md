### 																				面试题总结

### Dubbo

---

1.  服务调用超时问题怎么解决？

> dubbo默认有重试机制，服务端设置了超时请求的时间后，就会有重试机制。去除重试次数 ，并且设置超时时间,业务代码放到服务端调用端不涉及业务代码。

```xml
<dubbo:provider delay="-1" timeout="6000" retries="0" ></dubbo>
```

2. 超时是针对消费端还是服务端?

>  针对消费端，消费端发送一个请求到服务端，若未在规定时间内返回则请求异常 ,此时服务端代码一直在执行。
>
> 针对服务端，消费端发送一个请求到服务端，服务端超过设置的执行时间，直接返回超时异常。

3. Dubbo支持哪些序列化方式？

>+ Henssian序列化：是修改过的Hessian lite，默认启用
>+ json序列化：使用FastJson库
>+ java 序列化：JDK 提供的序列化，性能不理想
>+ dubbo 序列化：未成熟的高效 java 序列化实现，不建议在生产环境使用

4. Dubbo和SpringCloud的关系？

>dubbo是阿里巴巴开发一款高性能rpc框 采用二进制流方式通信占用带宽少 面向接口编程 提供智能容错与负载均衡 服务的注册与发现 注重服务的治理

![dubbo架构图](\dubbo.png "图 1-1")

> springcloud 提供了一组服务框架的有序集合  gateway 网关、服务注册中心、断路器用于服务的降级与限流、config 服务配置中心、OpenFeign便于声明化调用http客户端 
>
> dubbo在微服务架构只是相当于一部分 而springcloud则包括微服务的全部

5. Dubbo的架构设计？一共划分了哪些层？

> 服务提供者provider、服务消费者consumer、注册中心register、监听器monitor、容器container
>
> + 服务接口层（service）：该层是与实际业务逻辑相关的，根据服务提供方和服务消费方的业务设计对应的接口和实现。
> + 配置层（config）：对外配置接口，以ServiceConfig和ReferenceConfig为中心，可以直接new配置类，也可以通过spring解析配置生成配置类。
> + 服务代理层（proxy）：服务接口透明代理，生成服务的客户端Stub和服务器端Skeleton，以ServiceProxy为中心，扩展接口为ProxyFactory。
> + 服务注册层（Registry）：封装服务地址的注册与发现，以服务URL为中心。
> + 集群层（Cluster）：封装多个提供者的路由及负载均衡，并桥接注册中心，以Invoker为中心。
> + 监控层（Monitor）：Rpc调用次数和调用时间监控。
> + 远程调用层（Protocol）:封装Ppc调用，以Invocation和Result为中心，扩展接口为Protocol、Invoker、Exporter
> + 信息交换层（Exchange）：封装请求响应模式，同步转异步，以Request和Response为中心。
> + 网络传输层（Transport）：抽象mina和netty为统一接口，以Message为中心。

6. Dubbo的默认集群容错方案？

> * failover cluster:失败自动切换，当出现失败，重试其他服务器，用于读操作，会带来更长延迟。此为缺省默认集群模式。

7. Dubbo使用的是什么通信框架?

> 默认是用netty通信

8. Dubbo的主要应用场景？

> + 单一应用架构：功能模块都在一台服务器上运行，使用开发过程中，占用的资源越来越多，流量增加使得流量更加难以维护。此时orm是关键。
> + 垂直应用架构：将单节点应用 按照‘mvc’模式层分成一个个独立的子系统 应用横向部署在多个节点上。此时web框架的mvc是关键。
> + 分布式应用架构：将各个功能独立成单独的子系统，各个子系统之间通过协议相互通信调用，团队分工更加明确。此时RPC框架是关键。
> + 流动计算架构：当服务越来越多，容量的评估，小服务资源的浪费等问题，此时需要一个调度中心基于访问压力实时管理集群容量，提高集群利用率。

8. Dubbo服务注册与发现的流程？

> 容器初始化下游服务即服务提供者，并注册到register注册中心，上游服务即服务消费者通过异步订阅注册列表，当注册列表有改变的时候则异步通知上游服务即服务消费者，上游服务即服务消费者本地负载均衡通过缓存到本地服务列表直接同步调用相应的服务。下游服务提供者与上游服务消费者异步发送到Dubbo Monitor监听器。

9. Dubbo的集群容错方案有哪些？

> * failover cluster:失败自动切换，当出现失败，重试其他服务器，用于读操作，会带来更长延迟。
> * failfast cluster:快速失败，只调用一次，用于非幂等操作。
> * failsafe cluster：失败安全，出现异常直接忽略，用于日志记录。
> * failback cluster：失败自动恢复，后台及记录失败请求 ，定时重发，通常用于消息通知。
> * Forking cluster：并行调用多个服务，只要有一个成功即返回，用于实时性抢的读操作，会浪费更多服务器资源。
> * Broadcast cluster：广播调用所有提供者，一个个调用，一个报错则报错，用于更新提供者本地缓存或日志。

10. Dubbo的四大组件

> + provider：服务提供者
> + Register：注册中心
> + consumer：服务消费者
> + monitor：监控中心

11.  Dubbo在安全机制方面是如何解决的

> dubbo通过token防止绕过注册中心直连，然后再注册中心管理授权，dubbo提供黑白名单来控制所有服务的调用方。

12. Dubbo和SpringCloud的区别？

> dubbo采用二进制流的方式通行 springcloud采用HTTP协议 以Restful规范通信。springcloud占用的带宽比dubbo大。
>
> dubbo只是一个RPC框架 。
>
> springcloud 是基于微服务分布式的解决方案。
>
> dubbo只是springcloud的一部分功能。

13.  Dubbo支持哪些协议，每种协议的应用场景，优缺点？

> dubbo 协议单一长连接和NIO异步通信，适合大并发量小数据量的场景，消费者远大于提供者。传输协议TCP,异步,Hession序列化。
>
> rmi协议采用java标准的rmi协议实现，传输参数与返回参数需要实现Serializable接口，使用java标准序列化机制，使用阻塞短连接，传输数据包大小混合，可传输文件，消费者与提供者大小混合。传输协议TCP,同步传输，适用常规远程服务调用和rmi互操。低版本的Common-Collection包，java序列化存在漏洞。
>
> webService：基于webService的远程调用协议，提供和原生webSerivce互操作，多个短连接，基于HTTP传输，同步传输，适用系统集成和快语言调用。
>
> http：基于http表单提交的远程调用协议，使用Spring的HttpInvoke实现。多个短连接，传输协议http，传入参数大小混合，提供者个数多于消费者，需要给应用程序和浏览器js调用
>
> hessian：集成Hessian服务，基于HTTP通讯，采用servlet暴露服务，内嵌jetty作为服务实现，提供与Hessian服务互操作。多个短连接，同步传输，Hassian序列化，提供者大于消费者，提供者压力较大，可传文件。
>
> memcache：基于memcache实现的rpc协议
>
> redis：基于redis实现的rpc协议
>
> thrift：对thrift原生协议的扩展
>
> rest：基于rest api实现的rest调用 json序列化
>
> grpc：使用http2.0通信。

14. Dubbo的核心功能有哪些？

> Remoteing：网络通信框架，提供多种NIO框架抽象封装，多种线程模型、序列化、同步转异步和请求-响应模式的信息交换方式。
>
> cluster：集群容器，提供基于接口方法的透明远程调用，包括多协议支持、软负载均衡、失败容错、地址路由、动态配置等集群支持。
>
> Register：服务注册，基于注册中心目录服务，使服务消费方能动态的查询服务提供方，使地址透明，使服务提供方可以平滑增加或减少机器。

15. Dubbo的注册中心集群挂掉，发布者和订阅者之间还能通信么？

> 还可以通信的，服务消费者会将订阅的服务列表缓存到本地，注册中心挂了后依然可以通过本地的缓存列表调用服务，只是不能调用注册中心新增加的。

16.  Dubbo集群的负载均衡有哪些策略？

> Random loadbalance :随机算法 调用负载均衡，可以对provider不同实例的权重，会按照权重负载均衡，权重越大负载流量越大，相同权重大流量下负载会越平均。
>
> Roundrobbin loadbalance：轮询算法 均匀的调用各个服务，各个机器的性能不一样，容易导致性能越差的负载过高。可以通过调整权重让性能差的权重小一些。
>
> leastactive loadbalance：最少活跃数算法 给活跃数少的机器更少的请求。
>
> consistanthash loadbalance：一致性hash算法 相同参数分发到一台机器上。

17. 为什么需要服务治理？



 1.20 Dubbo超时时间怎样设置？

###  ElasticSearch

-----

1. 你们公司的ES集群，一个node一般会分配几个分片？

2. Elasticsearch是如何实现Master选举的？

3. 你是如何做写入调优的？

4. 如何避免脑裂？

 2.5 19-Elasticsearch对于大数据量（上亿量级）的聚合如何实现？

 2.6 ES主分片数量可以在后期更改吗？为什么？

 2.7 ES主分片数量可以在后期更改吗？为什么？

 2.8 如何监控集群状态？

 2.9 ElasticSearch中的副本是什么？

 2.10 20-Elasticsearch是如何实现Master选举的？

 2.11 20.ES更新数据的执行流程？

 2.12 shard里面是什么组成的？

 2.13 ElasticSearch中的分析器是什么？

 2.14 什么是脑裂？

 2.15 20-Elasticsearch是如何实现Master选举的

 2.16 客户端在和集群连接时，如何选择特定的节点执行请求的？

 2.17 Elasticsearch中的倒排索引是什么？

 2.18 什么是脑裂？

 2.19 什么是索引？索引（名词） 一个索引(index)

 2.20 详细描述一下Elasticsearch更新和删除文档的过程

### JVM

---

1. JVM参数主要有⼏种分类

> HotSpot JVM提供了三类参数
>
> * 第一类参数为标准参数 jvm输入和输出的参数是稳定的 很可能在以后的版本中不会改变 java -help 检索出所有标准参数 例如：-server
> * 第二类是X参数为非标准参数  将来的版本很可能会改变 -X
> * 第三类是包含XX参数

2. Java中会存在内存泄漏吗，简述一下。

3. Java虚拟机是如何判定两个Java类是相同的？

 3.4 Java 中都有哪些引用类型

 3.5 在 Java 中，对象什么时候可以被垃圾回收？

 3.6 19.StackOverflow异常有没有遇到过？一般你猜测会在什么情况下被触发？

 3.7 堆空间分哪些部分？以及如何设置各个部分？

 3.8 什么是栈帧？栈帧存储了什么？

 3.9 如何设置参数生成GC日志？

 3.10 GC 是什么？为什么要有 GC？

 3.12 使用过哪些jdk命令，并说明各个的作用是什么

 3.13 JVM运行时数据区区域分为哪⼏部分？

 3.14 是否了解类加载器双亲委派模型机制和破坏双亲委派模型？

 3.15 逃逸分析有几种类型？

 3.16 -Xms这些参数的含义是什么？

 3.17 你知道哪几种垃圾收集器,各自的优缺点，重点讲下cms和G1，包括原理，流程，优缺点。

 3.18 JVM的内存结构，Eden和Survivor比例是多少？



####  消息中间件

-----

1 消费者获取消息有几种模式？

 2 17.RocketMQ的特点有哪些？

 5.3 kafka 同时设置了 7 天和 10G 清除数据，到第五天的时候消息达到了 10G，这个时候 kafka将如何处理？

 5.4 为何需要Kafka集群

 5.5 Kafka 数据存储设计

 5.6 Kafka如何判断一个节点是否存活？

 5.7 kafka消息发送的可靠性机制有几种

 5.8 请详细说一下推送模式和拉取模式。

 5.9 Kafka 与传统消息系统之间有三个关键区别

 5.10 RocketMQ 由哪些角色组成？

 5.12 23.Kafka的消费者如何消费数据

 5.13 Kafka的优点

 5.14 Kafka 的设计时什么样的呢？

 5.15 说说你对Consumer的了解？

 5.16 Kafka新建的分区会在哪个目录下创建

 5.17 说一下Kafka消费者消费过程

 5.18 介绍下Kafka

 5.19 什么情况会导致Kafka运行变慢？



### 亿级流量电商系统JVM性能调优实战

-----

1. 深入剖析Java虚拟机内存模型

> 1.8  ：线程公用的 {    堆（新生代（Eden、s0、s1）、老年代（old））元空间（方法区|永久代）}  线程独立的{栈（栈帧：）}

2. JVM垃圾收集机制解密

3. 常见JVM诊断工具调优实战

4. 亿级流量电商网站JVM参数调优实战

5. 日均百万级交易系统JVM调优实战

6. Java虚拟机常见面试题剖析

7. 动手实战优化自己公司线上系统JVM

8. 作业安排

**二、亿级数据Mysql底层索引性能优化最佳实践**

1. 索引数据结构红黑树，Hash，B+树能说下吗？

   > 索引是帮助查找排好序的数据结构，若是索引底层是二叉树则左边的元素小于父元素，右边的元素大于父元素 数量在非常大会形成单边增长的二叉树相当于全表扫描。
   >
   > 
   >
   > 

2. 千万级数据表如何用索引快速查找？

3. 如何基于索引B+树精准建立高性能索引？

4. 联合索引底层数据结构又是怎样的？

5. 覆盖索引与聚集索引到底是什么？

6. Mysql最左前缀优化原则是什么？

**三、关于BIO，NIO，AIO，Netty及Redis线程模型**

1. BIO，NIO，AIO的区别？
2. 什么是阻塞IO以及非阻塞IO？ 
3. Reactor和Proactor IO设计模式是什么？
4. NIO底层select、poll和epoll实现的区别 ？
5. Java NIO的几个核心组成部分是什么？作用分别是什么？
6. Redis、Netty、Tomcat的线程模型与NIO的联系是什么？

### Redis

-----

1.Redis支持的数据类型？

2.什么是Redis持久化？Redis有哪几种持久化方式？优缺点是什么？

3.Redis 有哪些架构模式？讲讲各自的特点

4.使用过Redis分布式锁么，它是怎么实现的？

5.使用过Redis做异步队列么，你是怎么用的？有什么缺点？

6.什么是缓存穿透？如何避免？什么是缓存雪崩？何如避免？

7.Redis常用命令

8.为什么Redis 单线程却能支撑高并发？

9.说说Redis的内存淘汰策略

10.Redis的并发竞争问题如何解决?



### 线程

----

1. 线程的本质(操作系统与CPU是如何执行线程的)
2. 纤程的本质(go语言纤程为什么和线程池有关)
3. 并发的本质是什么？锁的本质是什么？
4. synchronized关键字的字节码原语
5. 无锁、偏向锁、轻量级锁、重量级锁升级过程
6. 偏向锁和重量级锁的应用场景
7. 偏向锁的启动延迟
8. 为什么偏向锁会有启动延迟？
9. 自旋锁(CAS)的最底层实现
10. 自旋锁何时升级重量级锁
11. 用JOL手工观察锁升级的过程

12. 什么是CPU缓存L1 L2 L3？

13. 什么是缓存行？

14. 为什么会有缓存行？

15. 缓存行的大小是多少？

16. 缓存行如何影响Java编程

17. Disruptor框架如何使用缓存行填充提高效率？

18. 什么是CPU的乱序执行？

19. 如何证明CPU的乱序执行？

20. 什么是内存屏障？

21. JVM如何用内存屏障禁止重排序？

22. DCL单例中不禁止重排序会造成什么严重后果？

23. 通过阿里一道面试题理解响应式线程池应用

24. 无锁、偏向锁、轻量级锁、重量级锁有什么差别？

    synchronized 、volatile的CPU原语是如何实现的？

    线程间通信，同机器进程间通信，跨机器进程间通信，各有什么方法？

    线程和纤程的区别的是什么？为什么纤程比较轻量级？

    ThreadLocal有没有内存泄漏的问题？为什么？

 4.1 负载平衡的意义什么？

 4.2 请说出同步线程及线程调度相关的方法？

 4.3 关于epoll和select的区别，哪些说法 是正确的？（多选） 

A. epoll 和 select 都是 I/O 多路复用的技术，都可以实现同时监听 多个I/O事件的状态。 

B. epoll 相比 select 效率更高，主要是基于其操作系统支持的 I/O 事件通知机制，而select是基于轮询机制。 

C. epoll支持水平触发和边沿触发两种模式。 

D. select能并行支持I/O比较小，且无法修改。

 4.4 启动一个线程是调用run()方法还是start()方法？

 4.5 如何确保N个线程可以访问N个资源同时又不导致死锁？

 4.6 编写多线程程序的几种实现方式（换个问法：创建多线程的方式）？

 4.7 线程和进程的区别？

 4.8 什么是线程池，有哪些常用线程池？

 4.9 什么是死锁？

 4.10 怎么保证缓存和数据库数据的一致性？

### 解决方案

----

流量削峰  

> 削峰从本质上来说就是更多地延缓用户请求，以及层层过滤用户的访问需求，遵从“最后落地到数据库的请求数要尽量少”的原则。
>
> ##### 1. **消息队列解决削峰**
>
> 用消息队列缓冲瞬时流量，把同步的直接调用转换成异步的推送，中间通过中间件承接瞬时的洪峰，里一端平滑的将消息推送出去。消减进入下流的洪峰流量。
>
> 2.**流量削峰漏斗：层层削峰**
>
> 请求进行分层过滤，过滤到一些无用的请求。通过不同层次过滤掉过期的失效请求。通过cdn过滤掉大量图片与静态资源。然后再通过分布式缓存，过滤请求等典型拦截上游请求。
>
> 对写数据进行基于时间的合理分片，过滤掉过期的失效请求。
>
> 对写请求做限流保护，将超出系统承载能力的请求过滤掉。
>
> 涉及到的读数据不做强一致性校验，减少因为一致性校验产生瓶颈的问题。
>
> 对写数据进行强一致性校验，只保留最后有效的数据。
>
> 最终，让“漏斗”最末端(数据库)的才是有效请求。例如：当用户真实达到订单和支付的流程，这个是需要数据强一致性的。
>
> **流量削峰原则**
>
> 高并发场景 尽量将请求拦截在系统上游 ，减小下游压力。如果不在前端拦截很可能造成数据库读写锁冲突，导致死锁，最终可能出现雪崩现象。
>
> 划分好动静资源，静态资源使用 浏览器请求头设置缓存时间 cdn进行静态资源的分发 nginx
>
> 充分利用好缓存（例如redis）：增加qps 从而加大整个集群的吞吐量
>
> 通过消息中间件拦截上游的流量洪峰，在另一端平滑的将消息推送到下游服务并执行。

redis过期时间设置依据  

慢查询优化 

库存不够扣怎么解决 

设计一个支持100w用户的系统架构  

高并发解决方案

线上jvm问题

### github 相关

-----

1.多个github账户使用同一台电脑？

```  shell
ssh-keygen -t rsa -f ~/.ssh/id_rsa_x -C "work_haoss@163.com"
touch config
vim config

Host github.com
     HostName github.com
     PreferredAuthentications publickey
     IdentityFile ~/.ssh/id_rsa
     User git
     
Host github.com
     HostName github.com
     PreferredAuthentications publickey
     IdentityFile ~/.ssh/id_rsa_book
     User git
     # User@HostName:个人账户名
```

